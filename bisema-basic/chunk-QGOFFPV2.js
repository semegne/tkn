import{a as ie}from"./chunk-M6IFIDZJ.js";import{h as ee}from"./chunk-5KWWAODE.js";import{b as Y,c as v,d as U,e as H,f as J,g as x,i as z,k as K,l as W,m as X,s as Z}from"./chunk-HZJXUBZX.js";import{b as te}from"./chunk-WNN6VJ2G.js";import"./chunk-D4X6XHNH.js";import{Ba as w,C as y,Ca as T,H as b,Hb as Q,I as E,Ib as $,J as N,Lb as A,Ma as D,Na as k,Oa as P,Qa as n,Ra as c,Sa as O,Z as o,_a as u,cb as h,db as _,ea as B,eb as R,ia as M,ja as S,nb as G,oa as d,ob as V,sa as t,sb as q,ta as i,tb as j,ua as l,ub as L,ya as F}from"./chunk-YBJUVPDF.js";import"./chunk-4CLCTAJ7.js";var oe=["dataToExport"],ae=["content"],C=s=>({"bg-red":s});function le(s,a){if(s&1&&(t(0,"tr",30)(1,"td",31),n(2),i(),t(3,"td",31),n(4),h(5,"uppercase"),i(),t(6,"td",31),n(7),h(8,"uppercase"),i(),t(9,"td",32),n(10),i(),t(11,"td",31),n(12),i(),t(13,"td",31),n(14),h(15,"currency"),i(),t(16,"td",31),n(17),i(),t(18,"td",31),n(19),h(20,"currency"),i()()),s&2){let e=a.$implicit,r=a.index,m=T();o(),d("ngClass",u(24,C,!e.is_special&&e.order_code.trim().includes("??")||e.is_special&&e.code.trim().includes("??"))),o(),c(r+1),o(),d("ngClass",u(26,C,!e.is_special&&e.order_code.trim().includes("??")||e.is_special&&e.code.trim().includes("??"))),o(),c(_(5,16,e.product.company_code)),o(2),d("ngClass",u(28,C,!e.is_special&&e.order_code.trim().includes("??")||e.is_special&&e.code.trim().includes("??"))),o(),c(_(8,18,e.product.catalogue_code)),o(2),d("ngClass",u(30,C,!e.is_special&&e.order_code.trim().includes("??")||e.is_special&&e.code.trim().includes("??"))),o(),c(e.is_special?e.code:e.order_code),o(),d("ngClass",u(32,C,!e.is_special&&e.order_code.trim().includes("??")||e.is_special&&e.code.trim().includes("??"))),o(),c(e.is_special?e.special_name:e.product.name),o(),d("ngClass",u(34,C,!e.is_special&&e.order_code.trim().includes("??")||e.is_special&&e.code.trim().includes("??"))),o(),c(_(15,20,m.getTotalPrice(e))),o(2),d("ngClass",u(36,C,!e.is_special&&e.order_code.trim().includes("??")||e.is_special&&e.code.trim().includes("??"))),o(),c(e.qty),o(),d("ngClass",u(38,C,!e.is_special&&e.order_code.trim().includes("??")||e.is_special&&e.code.trim().includes("??"))),o(),c(_(20,22,e.qty*m.getTotalPrice(e)))}}function de(s,a){if(s&1){let e=F();t(0,"div",33)(1,"div",34)(2,"h5",35),n(3,"BiSemA Corporation Cloud Specification Services"),i()(),t(4,"h5",36),n(5,"Your Order Admin Dealer has been sent."),i(),t(6,"div",37)(7,"button",38),w("click",function(){let m=b(e).$implicit,p=T();return m.dismiss("Cross click"),E(p._router.navigateByUrl("/"))}),n(8,"Close"),i()()()}}var ne=class s extends te{fromPerson=new J({name:new x("",[v.required]),email:new x("",[v.required,v.email]),phone:new x("",[v.required]),address:new x("",[v.required])});cart=[];grandTotal=null;calGrandTotal=null;discountControl=new x("");dataToExport;content;modalService=y(ee);_router=y(Q);getControl(a){return this.fromPerson.get(a)}getCart(){this._cartService.getCart().subscribe({next:a=>{this.loadCartDetails(a.data)}})}loadCartDetails(a){this.cart=[];let e=0;a.length>0&&a.forEach(r=>{e=e+ +(r.qty*this.getTotalPrice(r)),this.cart.push(r)}),this.grandTotal=parseFloat(e.toString()).toFixed(2),this.calGrandTotal=this.grandTotal}getTotalPrice(a){let e=a.is_special?a.special_price:a.product.price;if(!a.is_special)for(let r=0;r<a.finish_prices.length;r++)e=e+a.finish_prices[r];return e=parseFloat(e).toFixed(2),e}order(){if(this.cart.find(p=>p.order_code.includes("?"))){this.error("You cannot send order without choosing the finishes");return}let e=this,r=this.dataToExport.nativeElement,m={margin:0,image:{type:"jpeg",quality:.98},html2canvas:{scale:3},jsPDF:{orientation:"landscape",unit:"mm",format:"a4",compressPDF:!0}};html2pdf().from(r).set(m).toPdf().output("datauristring").then(function(p){p=p.replace("filename=generated.pdf;",""),p=p.split(",")[1];let g=new Date,re=g.getFullYear()+"-"+("00"+(g.getMonth()+1)).slice(-2)+"-"+("00"+g.getDate()).slice(-2)+" "+("00"+g.getHours()).slice(-2)+":"+("00"+g.getMinutes()).slice(-2)+":"+("00"+g.getSeconds()).slice(-2),f=new FormData;f.append("pdf",p),f.append("email","bisema@gmail.com"),f.append("cart",JSON.stringify(e.cart)),f.append("user_email",`${e.fromPerson.value.email}`),f.append("user_name",`${e.fromPerson.value.name}`),f.append("total_price",`${e.calGrandTotal}`),f.append("orderConfirmationDate",re),e._mainService.order(f).subscribe({next:I=>{I.status!="error"?e.openOrderSuccessModal():e.error("Something went wrong. Please try agin later"),e.success(I.message)}})})}openOrderSuccessModal(){this.modalService.open(this.content,{centered:!0,modalDialogClass:"modal-content-custom"})}calculateDiscount(){let a=this.grandTotal/100*this.discountControl.value;this.calGrandTotal=this.grandTotal-a}ngOnInit(){this.discountControl.valueChanges.subscribe(a=>{this.calculateDiscount()}),this.getCart()}static \u0275fac=(()=>{let a;return function(r){return(a||(a=N(s)))(r||s)}})();static \u0275cmp=B({type:s,selectors:[["app-checkout"]],viewQuery:function(e,r){if(e&1&&(D(oe,5),D(ae,7)),e&2){let m;k(m=P())&&(r.dataToExport=m.first),k(m=P())&&(r.content=m.first)}},features:[M],decls:130,vars:21,consts:[["dataToExport",""],["content",""],[1,"container-fluid"],[1,"row","bg-white"],[1,"col-12"],["routerLink","/",1,"float-right","btn","btn2","mt-2"],[1,"d-flex","justify-content-between","py-2"],[1,"mt-2"],[1,"border-dark"],[1,"col-md-6","col-12"],[1,"mt-4"],[3,"formGroup"],["for","from_name",1,"form-label"],["type","text","id","from_name","placeholder","Enter Name","formControlName","name",1,"form-control"],[1,"text-danger"],["fieldType","input",3,"control","fieldLabel"],["for","from_email",1,"form-label"],["type","email","id","from_email","placeholder","Enter Email","formControlName","email",1,"form-control"],["for","from_phone",1,"form-label"],["type","text","id","from_phone","placeholder","Enter Phone","formControlName","phone",1,"form-control"],["for","from_address",1,"form-label"],["id","from_address","rows","3","formControlName","address",1,"form-control"],[1,"table","table-striped"],[1,"thead-light"],[2,"white-space","nowrap"],["class","",4,"ngFor","ngForOf"],[1,"border","border-0"],["type","text",1,"form-control",3,"formControl"],[1,"d-flex","justify-content-end"],["type","button",1,"btn","btn2","me-1","px-3",3,"click","disabled"],[1,""],[3,"ngClass"],[2,"white-space","nowrap",3,"ngClass"],[1,"modal-body"],[1,"bg-purple"],[1,"text-center","text-white","p-2"],[1,"text-center"],[1,"d-flex","justify-content-end","mt-5"],["type","button",1,"btn","btn2","border-white",3,"click"]],template:function(e,r){if(e&1){let m=F();t(0,"div",2)(1,"div",3)(2,"div",4)(3,"a",5),n(4,"Back to Main"),i()()(),t(5,"div",3,0)(7,"div",4)(8,"div",6)(9,"h4",7),n(10," Invoice "),i()()(),l(11,"hr",8),t(12,"div",9)(13,"h2",10),n(14,"Buyer's Information : "),i(),t(15,"form",11)(16,"div")(17,"label",12),n(18,"Name"),i(),l(19,"input",13),t(20,"label",14),l(21,"app-validation-error",15),i()(),t(22,"div")(23,"label",16),n(24,"Email"),i(),l(25,"input",17),t(26,"label",14),l(27,"app-validation-error",15),i()(),t(28,"div")(29,"label",18),n(30,"Phone"),i(),l(31,"input",19),t(32,"label",14),l(33,"app-validation-error",15),i()(),t(34,"div")(35,"label",20),n(36,"Address"),i(),l(37,"textarea",21),t(38,"label",14),l(39,"app-validation-error",15),i()()()(),t(40,"div",9)(41,"h2",10),n(42,"Product Details"),i(),t(43,"table",22)(44,"thead",23)(45,"tr")(46,"th"),n(47,"#"),i(),t(48,"th"),n(49,"Mfg"),i(),t(50,"th"),n(51,"Cat"),i(),t(52,"th",24),n(53,"Order Code"),i(),t(54,"th"),n(55,"Description"),i(),t(56,"th"),n(57,"Rate"),i(),t(58,"th"),n(59,"Quantity"),i(),t(60,"th"),n(61,"Amount"),i()()(),t(62,"tbody"),S(63,le,21,40,"tr",25),t(64,"tr"),l(65,"td",26)(66,"td",26)(67,"td")(68,"td")(69,"td"),t(70,"td"),n(71,"Discount %"),i(),l(72,"td"),t(73,"td"),l(74,"input",27),i()(),t(75,"tr"),l(76,"td",26)(77,"td",26)(78,"td")(79,"td")(80,"td"),t(81,"td"),n(82,"Sub Total"),i(),l(83,"td"),t(84,"td"),n(85),h(86,"currency"),i()(),t(87,"tr"),l(88,"td",26)(89,"td",26)(90,"td")(91,"td")(92,"td"),t(93,"td"),n(94,"Tax (5%)"),i(),l(95,"td"),t(96,"td"),n(97,"0"),i()(),t(98,"tr"),l(99,"td",26)(100,"td",26)(101,"td")(102,"td")(103,"td"),t(104,"td"),n(105,"Total"),i(),l(106,"td"),t(107,"td"),n(108),h(109,"currency"),i()(),t(110,"tr"),l(111,"td",26)(112,"td",26)(113,"td")(114,"td")(115,"td"),t(116,"td"),n(117,"Balance Due"),i(),l(118,"td"),t(119,"td")(120,"b"),n(121,"CAD"),i(),n(122),h(123,"currency"),i()()()()()(),l(124,"hr",8),t(125,"div",28)(126,"button",29),w("click",function(){return b(m),E(r.order())}),n(127," Order "),i()()(),S(128,de,9,0,"ng-template",null,1,R)}e&2&&(o(15),d("formGroup",r.fromPerson),o(6),d("control",r.getControl("name"))("fieldLabel","Name"),o(6),d("control",r.getControl("email"))("fieldLabel","Email"),o(6),d("control",r.getControl("phone"))("fieldLabel","Phone"),o(6),d("control",r.getControl("address"))("fieldLabel","Address"),o(24),d("ngForOf",r.cart),o(11),d("formControl",r.discountControl),o(11),c(_(86,15,r.grandTotal)),o(23),c(_(109,17,r.grandTotal)),o(14),O(" ",_(123,19,r.calGrandTotal),""),o(4),d("disabled",!r.fromPerson.valid))},dependencies:[L,G,V,q,j,Z,z,Y,U,H,K,W,X,ie,A,$],styles:[".modal-body[_ngcontent-%COMP%]{background:#faccf780;border:2px solid #88149d;border-radius:25px}"]})};export{ne as CheckoutComponent};
