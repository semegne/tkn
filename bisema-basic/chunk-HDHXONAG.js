import{a as ue,c as ge}from"./chunk-VN5D2FZI.js";import{a as pe,b as _e}from"./chunk-CE264D3Z.js";import{b as ae,d as ce,h as se,r as le,s as de}from"./chunk-LSGPDU6X.js";import{a as me,b as he}from"./chunk-5ZGYSYZV.js";import"./chunk-QPHC7RMV.js";import{$a as B,Ba as g,Ca as p,Fa as L,H as _,I as m,Ib as re,J as U,Ja as Q,Lb as oe,Ma as R,Na as z,Oa as A,Pa as S,Qa as s,Ra as I,Sa as w,Ta as $,Va as E,W as T,Wa as O,X as q,Xa as P,Z as c,_a as h,ab as K,bb as G,cb as y,db as v,ea as N,eb as H,ia as W,ja as f,na as V,nb as J,oa as d,ob as X,pb as Y,qa as j,qb as Z,rb as ee,sa as r,sb as te,ta as a,tb as ie,ua as C,ub as ne,va as F,wa as M,xa as D,ya as b}from"./chunk-7E6QOOYZ.js";import"./chunk-4CLCTAJ7.js";var Ce=["cartCheckboxes"],ye=o=>({"tbody-custom":o}),x=o=>({"bg-red":o}),ve=(o,t)=>({"clr-red":o,"text-success":t}),be=(o,t,e)=>({option:o,index:t,margin:5,item:e}),we=(o,t,e,i)=>({option:o,index:t,margin:e,item:i}),Ie=(o,t)=>({"bg-purple text-white":o,"clr-grey":t});function Se(o,t){o&1&&(r(0,"span"),s(1," / price:0"),a())}function Ee(o,t){if(o&1&&(r(0,"span"),s(1),a()),o&2){let e=p().index,i=p(2).$implicit;c(),$(" -> ",i.finish_labels[e]," | ",i.finish_prices[e],"")}}function Oe(o,t){if(o&1&&(r(0,"div"),D(1,45),a()),o&2){let e=t.$implicit,i=p().index,n=p(2).$implicit;p();let l=S(39);c(),d("ngTemplateOutlet",l)("ngTemplateOutletContext",K(2,be,e,i,n))}}function Pe(o,t){if(o&1){let e=b();r(0,"div",40)(1,"a",41),g("click",function(){let n=_(e).index,l=p(2).$implicit,u=p();return m(u.finishCollapseToggle(l,n))}),C(2,"i",42),s(3),f(4,Se,2,0,"span",18)(5,Ee,2,2,"span",18),a(),r(6,"div",43,4),f(8,Oe,2,6,"div",44),a()()}if(o&2){let e=t.$implicit,i=t.index,n=p(2).$implicit;c(),d("ngClass",B(6,ve,n.finish_labels[i].trim()=="??",n.finish_labels[i].trim()!="??")),c(2),w(" ",e.description," "),c(),d("ngIf",n.finish_prices[i]==0),c(),d("ngIf",n.finish_prices[i]!=0),c(),d("ngbCollapse",e.collapse),c(2),d("ngForOf",e.options)}}function ke(o,t){if(o&1&&(F(0,34),f(1,Pe,9,9,"div",39),M()),o&2){let e=p().$implicit;c(),d("ngForOf",e.product.groups)}}function Te(o,t){if(o&1){let e=b();r(0,"tr",22)(1,"td",16)(2,"b"),s(3),a()(),r(4,"td",16)(5,"input",23,1),g("keyup",function(){let n=_(e).index,l=S(6),u=p();return m(u.changeTagName(n,l.value))}),a()(),r(7,"td",16)(8,"input",24,2),g("click",function(){let n=_(e).$implicit,l=p();return m(l.checkBox(n))}),a()(),r(10,"td",25),C(11,"img",26),y(12,"lowercase"),y(13,"lowercase"),a(),r(14,"td",16),s(15),y(16,"uppercase"),a(),r(17,"td",16),s(18),y(19,"uppercase"),a(),r(20,"td",16)(21,"div",27)(22,"p",28),s(23),a(),r(24,"a",29),g("click",function(){let n=_(e).index,l=p();return m(l.editFinish(n))}),C(25,"i",30),a()(),f(26,ke,2,1,"ng-container",31),a(),r(27,"td",32)(28,"div",33)(29,"div")(30,"p",34),s(31),a()()()(),r(32,"td",35)(33,"div",36)(34,"button",37),g("click",function(){let n=_(e).index,l=p();return m(l.stepDown(n))}),s(35,"-"),a(),r(36,"input",38,3),g("keyup",function(){let n=_(e).index,l=S(37),u=p();return m(u.changePrice(n,l.value))}),a(),r(38,"button",37),g("click",function(){let n=_(e).index,l=p();return m(l.stepUp(n))}),s(39,"+"),a()()(),r(40,"td",16),s(41),y(42,"currency"),y(43,"currency"),a(),r(44,"td",16),s(45),y(46,"currency"),y(47,"currency"),a()()}if(o&2){let e=t.$implicit,i=t.index,n=p();c(),d("ngClass",h(42,x,!e.is_special&&e.order_code.trim().includes("??")||e.is_special&&e.code.trim().includes("??"))),c(2),w("",i+1,")"),c(),d("ngClass",h(44,x,!e.is_special&&e.order_code.trim().includes("??")||e.is_special&&e.code.trim().includes("??"))),c(),d("value",e.tag_name),c(2),d("ngClass",h(46,x,!e.is_special&&e.order_code.trim().includes("??")||e.is_special&&e.code.trim().includes("??"))),c(3),d("ngClass",h(48,x,!e.is_special&&e.order_code.trim().includes("??")||e.is_special&&e.code.trim().includes("??"))),c(),Q("src","",n.baseUrl,"",e.product.company_code,"/",v(12,26,e.product.catalogue_code),"/prod_icons/",v(13,28,e.product.label),"_3d.png",q),c(3),d("ngClass",h(50,x,!e.is_special&&e.order_code.trim().includes("??")||e.is_special&&e.code.trim().includes("??"))),c(),I(v(16,30,e.product.company_code)),c(2),d("ngClass",h(52,x,!e.is_special&&e.order_code.trim().includes("??")||e.is_special&&e.code.trim().includes("??"))),c(),I(v(19,32,e.product.catalogue_code)),c(2),d("ngClass",h(54,x,!e.is_special&&e.order_code.trim().includes("??")||e.is_special&&e.code.trim().includes("??"))),c(3),w(" ",e.is_special?e.code:e.order_code," "),c(3),d("ngIf",e.edit),c(),d("ngClass",h(56,x,!e.is_special&&e.order_code.trim().includes("??")||e.is_special&&e.code.trim().includes("??"))),c(4),I(e.is_special?e.special_name:e.product.name),c(),d("ngClass",h(58,x,!e.is_special&&e.order_code.trim().includes("??")||e.is_special&&e.code.trim().includes("??"))),c(4),L("value",e.qty),c(4),d("ngClass",h(60,x,!e.is_special&&e.order_code.trim().includes("??")||e.is_special&&e.code.trim().includes("??"))),c(),I(e.is_special?v(42,34,e.special_price):v(43,36,n.getTotalPrice(e))),c(3),d("ngClass",h(62,x,!e.is_special&&e.order_code.trim().includes("??")||e.is_special&&e.code.trim().includes("??"))),c(),I(e.is_special?v(46,38,e.qty*e.special_price):v(47,40,e.qty*n.getTotalPrice(e)))}}function Ve(o,t){if(o&1&&(r(0,"tr"),C(1,"td",46),r(2,"td",47),s(3,"Grand Total"),a(),r(4,"td",47),s(5),y(6,"currency"),a()()),o&2){let e=p();c(5),w(" ",v(6,1,e.grandTotal)," ")}}function Fe(o,t){if(o&1){let e=b();r(0,"div",48)(1,"button",49),g("click",function(){_(e);let n=p();return m(n.removeItem())}),C(2,"i",50),s(3," Delete "),a(),r(4,"button",51),g("click",function(){_(e);let n=p();return m(n.finishEdit())}),C(5,"i",30),s(6," Finish Editing "),a(),r(7,"a",52),s(8," Checkout "),a()()}if(o&2){let e=p();c(),d("disabled",e.deleteItem),c(3),d("disabled",e.finishEditing),c(3),j("disabled",e.cart.length==0)}}function Me(o,t){if(o&1&&(r(0,"div"),D(1,45),a()),o&2){let e=t.$implicit,i=p(2),n=i.index,l=i.margin,u=i.item;p();let k=S(39);c(),d("ngTemplateOutlet",k)("ngTemplateOutletContext",G(2,we,e,n,l+5,u))}}function De(o,t){if(o&1){let e=b();F(0),r(1,"a",54),g("click",function(){_(e);let n=p().option;return m(n.sub_group.collapse=!n.sub_group.collapse)}),s(2),a(),r(3,"div",43,5),f(5,Me,2,7,"div",44),a(),M()}if(o&2){let e=p(),i=e.option,n=e.margin;c(),V("style","margin-left: ",n,"px;",T),c(),w(" ",i.sub_group.description," "),c(),d("ngbCollapse",i.sub_group.collapse),c(2),d("ngForOf",i.sub_group.options)}}function Be(o,t){if(o&1){let e=b();r(0,"a",55),g("click",function(){_(e);let n=p(),l=n.option,u=n.index,k=n.item,fe=p();return m(fe.finish(k,l.name,u,l.price))}),s(1),a()}if(o&2){let e=p(),i=e.option,n=e.index,l=e.margin,u=e.item;V("style","margin-left: ",l,"px;",T),d("ngClass",B(4,Ie,i.name==u.finish_labels[n],i.name!=u.finish_labels[n])),c(),w(" ",i.description," ")}}function Ue(o,t){if(o&1&&f(0,De,6,5,"ng-container",18)(1,Be,2,7,"a",53),o&2){let e=t.option;d("ngIf",e.subgroup_id),c(),d("ngIf",!e.subgroup_id)}}function qe(o,t){o&1&&C(0,"div",56)}function Ne(o,t){if(o&1&&(r(0,"div",68),s(1),a()),o&2){let e=p(2);c(),w(" ",e.specialOrderValidationMessage," ")}}function We(o,t){if(o&1){let e=b();r(0,"div",57)(1,"div",58)(2,"h1",59),s(3,"Add product information"),a(),r(4,"div",60)(5,"span",61),s(6,"Product Code:"),a(),r(7,"input",62),P("ngModelChange",function(n){_(e);let l=p();return O(l.specialOrderProductCode,n)||(l.specialOrderProductCode=n),m(n)}),a()(),r(8,"div",60)(9,"span",61),s(10,"Product Price:"),a(),r(11,"input",62),P("ngModelChange",function(n){_(e);let l=p();return O(l.specialOrderUnitPrice,n)||(l.specialOrderUnitPrice=n),m(n)}),a()(),r(12,"div",60)(13,"span",61),s(14,"Order Code:"),a(),r(15,"input",62),P("ngModelChange",function(n){_(e);let l=p();return O(l.specialOrderCode,n)||(l.specialOrderCode=n),m(n)}),a()(),r(16,"div",60)(17,"span",61),s(18,"Product description:"),a(),r(19,"textarea",63),P("ngModelChange",function(n){_(e);let l=p();return O(l.specialOrderDescription,n)||(l.specialOrderDescription=n),m(n)}),a()(),f(20,Ne,2,1,"div",64),r(21,"div",65)(22,"button",66),g("click",function(){_(e);let n=p();return m(n.saveProductInformationDialog())}),s(23,"Save"),a(),r(24,"button",67),g("click",function(){_(e);let n=p();return m(n.cancelProductInformationDialog())}),s(25,"Cancel"),a()()()()}if(o&2){let e=p();c(7),E("ngModel",e.specialOrderProductCode),c(4),E("ngModel",e.specialOrderUnitPrice),c(4),E("ngModel",e.specialOrderCode),c(4),E("ngModel",e.specialOrderDescription),c(),d("ngIf",e.specialOrderValidationMessage!="")}}var xe=class o extends he{baseUrl=me.media_url;cart=[];selectedIndex=[];grandTotal=null;deleteItem=!0;finishEditing=!0;showProductInformationDialog=!1;specialOrderValidationMessage="";specialOrderProductCode="";specialOrderUnitPrice="";specialOrderDescription="";specialOrderCode="";cartCheckboxes;onDrop(t){this._mainService.getProduct(t.element.data.product_id).subscribe({next:e=>{let i=e.data;i.finish_labels=new Array(i.groups.length).fill(" ??"),i.finish_prices=new Array(i.groups.length).fill(0);let n=i.finish_labels.toString();n=n.replace(/,/g,"");let l={product_id:i.id,tag_name:"",order_code:i.label+n,finish_labels:i.finish_labels,finish_prices:i.finish_prices,qty:1};this._cartService.add(l).subscribe({next:u=>{this.getCart(),this.success(u.message),this._busService.sendShowCart()}})}})}changeTagName(t,e){this.cart[t].tag_name=e,this.update(this.cart[t])}checkBox(t){if(this.selectedIndex.find(i=>i==t)==null)this.selectedIndex.push(t);else{let i=this.selectedIndex.findIndex(n=>n==t);this.selectedIndex.splice(i,1)}this.deleteItem=this.selectedIndex.length==0}editFinish(t){let e=this.cart.findIndex(i=>i.edit==!0);e!=-1&&(this.cart[e].edit=!1),this.cart[t].edit=!0,this.finishEditing=!1}finishCollapseToggle(t,e){t.product?.groups.forEach((i,n)=>{n==e?i.collapse=!i.collapse:i.collapse=!0})}finish(t,e,i,n){t.finish_labels[i]=e,t.finish_prices[i]=n,t.order_code=t.product.label+t.finish_labels.toString().replace(/,/g,""),this.update(t)}stepDown(t){this.cart[t].qty!=1&&(this.cart[t].qty-=1,this.update(this.cart[t]))}stepUp(t){this.cart[t].qty+=1,this.update(this.cart[t])}changePrice(t,e){e>=1&&(this.cart[t].qty=e,this.update(this.cart[t]))}removeItem(){let t=this.selectedIndex.length-1;this.selectedIndex.forEach((e,i)=>{this._cartService.delete(e.id).subscribe({next:n=>{this._busService.sendShowCart(),t==i&&(this.success(n.message),this.getCart(),this.selectedIndex=[])},error:n=>{console.log(`Something went wrong while delete the cart items. Error details: ${JSON.stringify(n)}`)}})})}finishEdit(){this.cart.forEach(t=>{t.edit=!1})}update(t){let e={finish_labels:t.finish_labels,finish_prices:t.finish_prices,qty:t.qty,tag_name:t.tag_name,order_code:t.order_code,is_special:!0,code:t.code,special_price:t.special_price,special_name:t.special_name,_method:"PATCH"};this._cartService.update(e,t.id).subscribe({next:i=>{this.success(i.message)}})}getCart(){this._cartService.getCart().subscribe({next:t=>{t.data,this.loadCartDetails(t.data)}})}loadCartDetails(t){this.cart=[];let e=0;t.length>0&&t.forEach(i=>{i.edit=!1,e=e+ +(i.qty*this.getTotalPrice(i)),this.cart.push(i)}),this.grandTotal=parseFloat(e.toString()).toFixed(2)}getTotalPrice(t){let e=t.is_special?t.special_price:t.product.price;if(!t.is_special)for(let i=0;i<t.finish_prices.length;i++)e=e+t.finish_prices[i];return e=parseFloat(e).toFixed(2),e}showSpecialOrderForm(){if(this.selectedIndex.length>0){let t=this.cart.filter(e=>e.id===this.selectedIndex[0].id);t&&t.length>0?(this.specialOrderProductCode=t[0].product.label,this.specialOrderUnitPrice=t[0].product.price,this.specialOrderCode=t[0].order_code.replace(t[0].product.label,""),this.specialOrderDescription=t[0].product.name,this.specialOrderValidationMessage=""):(this.specialOrderProductCode="",this.specialOrderUnitPrice="",this.specialOrderDescription="",this.specialOrderValidationMessage=""),this.showProductInformationDialog=!0;return}this.error("Please select an item to continue")}cancelProductInformationDialog(){this.showProductInformationDialog=!1,this.selectedIndex=[],this.cartCheckboxes.forEach(t=>t.nativeElement.checked=!1),this.deleteItem=!0}saveProductInformationDialog(){if(this.selectedIndex&&this.selectedIndex.length>0)if(this.specialOrderProductCode!="")if(this.specialOrderUnitPrice!="")if(this.specialOrderDescription!=""){let t=this.cart.findIndex(e=>e.id===this.selectedIndex[0].id);t>-1?(this.cart[t].is_special=!0,this.cart[t].code=this.specialOrderProductCode+this.specialOrderCode,this.cart[t].special_price=parseFloat(this.specialOrderUnitPrice).toFixed(2),this.cart[t].special_name=this.specialOrderDescription,this.update(this.cart[t]),this.showProductInformationDialog=!1,this.selectedIndex=[],this.cartCheckboxes.forEach(e=>e.nativeElement.checked=!1),this.deleteItem=!0):this.error("It seems that the item you selected for special order not found. Please try again.")}else this.specialOrderValidationMessage="Please enter product description";else this.specialOrderValidationMessage="Please enter product price";else this.specialOrderValidationMessage="Please enter product code"}ngOnInit(){this.getCart()}static \u0275fac=(()=>{let t;return function(i){return(t||(t=U(o)))(i||o)}})();static \u0275cmp=N({type:o,selectors:[["app-cart"]],viewQuery:function(e,i){if(e&1&&R(Ce,5),e&2){let n;z(n=A())&&(i.cartCheckboxes=n)}},features:[W],decls:42,vars:8,consts:[["myFragment",""],["tagInput",""],["cartCheckboxes",""],["qtyInput",""],["finishCollapse","ngbCollapse"],["subfinishCollapse","ngbCollapse"],[1,"d-flex","justify-content-between","align-items-center"],[1,"mt-2","pt-2","text-center"],[1,"me-2"],[1,"clr-purple",2,"cursor","pointer",3,"click"],[1,"border-dark"],[1,"table","table-bordered",3,"treeDrop"],[1,"thead-light"],[1,"text-center"],["scope","col"],["scope","col",1,"bordNone"],[3,"ngClass"],["class","text-center data",4,"ngFor","ngForOf"],[4,"ngIf"],["class","col-12 text-end",4,"ngIf"],["class","dialog_overlay",4,"ngIf"],["class","card dialog",4,"ngIf"],[1,"text-center","data"],["type","text","placeholder","Type tagname ...",1,"tag-name",3,"keyup","value"],["type","checkbox",3,"click"],[1,"img-hover-zoom",3,"ngClass"],["width","100","alt","Buy",3,"src"],[1,"d-flex","justify-content-between"],[1,"code","text-start"],["href","javascript:;",3,"click"],["aria-hidden","true",1,"fa","fa-pencil"],["class","text-start",4,"ngIf"],[1,"bordNone",3,"ngClass"],[1,"cart-info"],[1,"text-start"],[1,"text-center",3,"ngClass"],[1,"input-group","bg-main","mb-3","qtyInput2"],["type","button",1,"btn","bg-light-purple","border",3,"click"],["min","1",1,"form-control","form-control-sm",3,"keyup","value"],["class","menu mb-2 text-start",4,"ngFor","ngForOf"],[1,"menu","mb-2","text-start"],["href","javascript:;",1,"text-decoration-none","text-start","fw-bold",3,"click","ngClass"],["aria-hidden","true",1,"fa","fa-caret-down"],[3,"ngbCollapse"],[4,"ngFor","ngForOf"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],["colspan","9"],[1,"fw-bold","text-center"],[1,"col-12","text-end"],[1,"float-right","btn","btn3","me-2",3,"click","disabled"],["aria-hidden","true",1,"fa","fa-trash"],[1,"float-right","btn","btn2","mx-1",3,"click","disabled"],["routerLink","/checkout","role","button",1,"float-right","btn","btn2","me-1"],["href","javascript:;","class","side-child-item p-1 text-decoration-none",3,"ngClass","click",4,"ngIf"],["href","javascript:;",1,"text-decoration-none","fw-bold",3,"click"],["href","javascript:;",1,"side-child-item","p-1","text-decoration-none",3,"click","ngClass"],[1,"dialog_overlay"],[1,"card","dialog"],[1,"card-body","bg-purple"],[1,"text-center","text-white","mb-3"],[1,"input-group","mb-3"],[1,"text-white","mt-2","mr-3",2,"width","20%"],["type","text",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-control",3,"ngModelChange","ngModel"],["class","input-group mb-3 text-white text-center","style","display: block",4,"ngIf"],[1,"mb-3","text-center"],[1,"btn","btn-light","btn2","me-3",3,"click"],[1,"btn","btn-light","btn2",3,"click"],[1,"input-group","mb-3","text-white","text-center",2,"display","block"]],template:function(e,i){if(e&1){let n=b();r(0,"div",6),C(1,"div"),r(2,"h4",7),s(3," List of products in cart "),a(),r(4,"div",8)(5,"a",9),g("click",function(){return _(n),m(i.showSpecialOrderForm())}),r(6,"h4"),s(7,"Order Special Product"),a()()()(),C(8,"hr",10),r(9,"table",11),g("treeDrop",function(u){return _(n),m(i.onDrop(u))}),r(10,"thead",12)(11,"tr",13)(12,"th"),s(13,"Item Number"),a(),r(14,"th"),s(15,"Tagname"),a(),r(16,"th",14),s(17,"Select"),a(),r(18,"th"),s(19,"Product Image"),a(),r(20,"th"),s(21,"Mfg"),a(),r(22,"th"),s(23,"Cat"),a(),r(24,"th"),s(25,"Order Code"),a(),r(26,"th",15),s(27,"Product Descriptions"),a(),r(28,"th",14),s(29,"Quantity"),a(),r(30,"th",14),s(31,"Unit Price"),a(),r(32,"th",14),s(33,"Total Price"),a()()(),r(34,"tbody",16),f(35,Te,48,64,"tr",17)(36,Ve,7,3,"tr",18),a()(),f(37,Fe,9,4,"div",19)(38,Ue,2,2,"ng-template",null,0,H)(40,qe,1,0,"div",20)(41,We,26,5,"div",21)}e&2&&(c(34),d("ngClass",h(6,ye,i.cart.length==0)),c(),d("ngForOf",i.cart),c(),d("ngIf",i.cart.length>0),c(),d("ngIf",i.cart.length>0),c(3),d("ngIf",i.showProductInformationDialog),c(),d("ngIf",i.showProductInformationDialog))},dependencies:[ne,J,X,Y,Z,te,ee,ie,ge,ue,de,ae,ce,_e,pe,oe,re,le,se],styles:[".qtyInput2[_ngcontent-%COMP%]{width:100px}.disabled[_ngcontent-%COMP%]{cursor:not-allowed}.link_disabled[_ngcontent-%COMP%], .link_disabled[_ngcontent-%COMP%]:hover{opacity:.5;cursor:not-allowed!important;color:#000!important}.dialog[_ngcontent-%COMP%]{top:50%;left:50%;width:50em;margin-top:-9em;margin-left:-25em;position:fixed;border:none!important;z-index:9999}.dialog_overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background-color:#000;opacity:.4;z-index:999}.tbody-custom[_ngcontent-%COMP%]{height:400px!important}"]})};export{xe as CartComponent};
